<html>
<head>
<link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="./css/bootstrap-datepicker.min.css">
		<link rel="stylesheet" type="text/css" href="./css/bootstrap-theme.min.css">
		<link rel="stylesheet" type="text/css" href="./css/bootstrap-year-calendar.min.css">
		<link rel="stylesheet" type="text/css" href="./css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="./css/style.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="Content-Type" content="text/html; charset=utf-8" />
		<meta name="title" content="Bootstrap year calendar" />
		<title>Bootstrap Year Calendar</title>
</head>
<body>

<div id="calendar"></div>
<div id="videos">here</div>



<script src="./js/respond.min.js"></script>
<script src="./js/jquery-1.10.2.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
<script src="./js/bootstrap-datepicker.min.js"></script>
<script src="./js/bootstrap-year-calendar.min.js"></script>
<script src="./js/bootstrap-popover.js"></script>
<script src="./js/scripts.js"></script>
<script type="text/javascript" class="publish">

$(function() {
        $.ajax({
			type: "POST",
            url: "json.php",
			data:  { 'mode'	: 'getCal' },
            success: function(data) {
				mydata = JSON.parse(data);
				//console.log(mydata);
                $('#calendar').data('calendar').setDataSource(mydata.video);
				$('#calendar').data('calendar').setMinDate(new Date(mydata.MinDate));
				$('#calendar').data('calendar').setMaxDate(new Date(mydata.MaxDate));
				//delete mydata;
            },
			error: function (xhr, ajaxOptions, thrownError) {
				$('#calendar').html('Error ' + xhr.status + ': ' + thrownError);	// Perhaps provide a more detailed error message
      }

        });
	$('#calendar').calendar({
		//style:'custom',
		enableContextMenu: false,
		enableRangeSelection: true,
		contextMenuItems:[
			{
				text: 'Show',
				click: null		// Change from null to function eventually
			},
		],
		selectRange: function(e) {
			console.log(e);
			console.log('\nRange Select: \nStartDate: ' + e.startDate + '\nEndDate: ' + e.endDate);
			 var RangeData = {
				'mode'			: 'range',
	            'startDate'		: e.startDate.getTime(),
	            'endDate'		: e.endDate.getTime(),
				'set'			: 1
        };
			$.ajax({
				type: 'POST',
	            url: "json.php", 
				data: RangeData,
	            success: function(data) {
					mydata = JSON.parse(data);
					if(mydata.status==0){
						$("#videos").html('');
						for(var i in mydata.range) {
							v = mydata.range[i];
							//console.log(v);
							content = '<div id="video">';
							content += '<img src="/GoPro/cache/'+ v.id + '_thumb.jpg">'
							+ v.id + ', ' + v.filename + ', ' + v.name + ': ' + v.description + '';
							content+='</div>';
							$("#videos").append(content);

						}
					} else {
						content += "Error: " + mydata.error;
							$("#videos").html(content);

					}
            },
					error: function (xhr, ajaxOptions, thrownError) {
					$('#calendar').html('Error ' + xhr.status + ': ' + thrownError);	// Perhaps provide a more detailed error message
      }
        });

		},
		mouseOnDay: function(e) {
			if(e.events.length > 0) {
				var content = '';
				
				for(var i in e.events) {
					vid=e.events[i];
					//console.log(vid);
					var Duration = new Date(parseInt(vid.duration));
					if(vid.name==null){
						vid.name="Untitled: ";
					}
					if(vid.description==null){
						vid.description="";
					}
					content += '<div class="event-tooltip-content">'
						+ '<div class="event-thumb"><a href="/GoPro/cache/'+ vid.id +'_low.mp4"><img src="/GoPro/cache/' + vid.id + '_thumb.jpg" height="100px"></a></div>'
									+ '<div class="event-name" style="color:' + vid.color + '">' + vid.name + '</div>'
									+ '<div class="event-description">' + vid.description + '</div>';
					if(Duration.valueOf()>3600000) {
									content+= '<div class="event-duration">' + Duration.getHours() + 'h' + Duration.getMinutes() + 'm' + Duration.getSeconds() + 's</div>';
					} else if(Duration.valueOf()>60000) {
									content+= '<div class="event-duration">' + Duration.getMinutes() + 'm' + Duration.getSeconds() + 's</div>';
					}else{
									content+= '<div class="event-duration">' + Duration.getSeconds() + 's</div>';

					}
					content+= '</div>';
				}
			
				$(e.element).popover({ 
					trigger: 'manual',
					container: 'body',
					html:true,
					content: content
				})
				

				
		.on("mouseenter", function () {
        var _this = this;
        $(this).popover("show");
        $(".popover").on("mouseleave", function () {
            $(_this).popover('hide');
        });
    }).on("mouseleave", function () {
        var _this = this;
        setTimeout(function () {
            if (!$(".popover:hover").length) {
                $(_this).popover("hide");
            }
        }, 300);
		});
				
				$(e.element).popover('show');
			}
		},
		mouseOutDay: function(e) {
			if(e.events.length > 0) {
				function callback(e){
   					return function(){
						e.popover.trigger
				        e.popover('hide');
			    	}
				}
			//	setTimeout(callback($(e.element)), 1000);
				//$(e.element).popover('hide');
			}
		},
		dayContextMenu: function(e) {
			$(e.element).popover('hide');
		},
		customDataSourceRenderer: function(element, date, events) {
			//console.log(date);
			//console.log(events);

            if(1) {
				$(element).css('background-color', '#93bcff');
//                $(element).css('color', 'grey');
                $(element).css('font-weight', 'bold');
//                $(element).css('font-size', '15px');
                //$(element).css('color', 'green');
		//		<div class="day-content">22</div>
				$(element).after('<span style="background-color:#93BCFF;position: relative; left: 6px; top:-20px ; font-size:80%;">' + events.length + '</span>');
            }
            else if(date.getTime() == 0) {
                $(element).css('background-color', 'red');
                $(element).css('color', 'white');
                $(element).css('border-radius', '15px');
            }
            else if(date.getTime() == 0) {
                $(element).css('border', '2px solid blue');
            }
        }
	});
	
});
</script>
</body>
</html>
